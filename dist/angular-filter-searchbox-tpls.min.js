/*! 
 * angular-filter-searchbox v1.0.0
 * https://github.com/edneyego/angular-filter-searchbox
 * Copyright (c) 2019 Nauck IT KG http://www.nauck-it.de/
 * License: MIT
 */

!function(){"use strict";angular.module("angular-filter-searchbox",[]).directive("nitAdvancedSearchbox",function(){return{restrict:"E",scope:{model:"=ngModel",parameters:"=",defaultparams:"=",filters:"=",enter:"=",save:"=",selectedFilter:"=",placeholder:"@"},replace:!0,templateUrl:function(e,a){return a.templateUrl||"angular-filter-searchbox.html"},controller:["$scope","$attrs","$element","$timeout","$filter",function(s,e,a,l,t){var r;s.placeholder=s.placeholder||"Search ...",s.searchParams=[],s.conditions=[{key:"=",value:"igual",restrict:[]},{key:"> <",value:"entre",restrict:["date","number","floating","list"]},{key:">",value:"maior_que",restrict:["text","list"]},{key:">=",value:"maior_igual",restrict:["text","list"]},{key:"<",value:"menor_que",restrict:["text","list"]},{key:"<=",value:"menor_igual",restrict:["text","list"]},{key:"< >",value:"diferente",restrict:[]}],s.selectedConditional="igual",s.searchQuery="",s.setSearchFocus=!1,s.Enter=s.enter,s.Save=s.save,s.SelectedFilter=s.selectedFilter;var i=[];function c(e,a,n){r&&l.cancel(r),(i=t("filter")(i,function(e){return e.key!==a})).push({command:e,key:a,value:n}),r=l(function(){angular.forEach(i,function(e){"delete"===e.command?delete s.model[e.key]:s.model[e.key]=e.value}),i.length=0},500)}s.defaultparams?s.defaultparams.query:s.defaultparams={},s.model=angular.copy(s.defaultparams),s.$watch("defaultparams",function(){s.model=angular.copy(s.defaultparams)}),s.$watch("model",function(e,a){angular.equals(e,a)||(angular.forEach(s.model,function(e,a){if("query"===a&&s.searchQuery!==e);else{var n=t("filter")(s.parameters,function(e){return e.key===a})[0],r=t("filter")(s.searchParams,function(e){return e.key===a})[0];void 0!==n&&(void 0===r?s.addSearchParam(n,e,!1):r.value!==e&&(r.value=e))}}),angular.forEach(s.searchParams,function(e,a){if(!s.model.hasOwnProperty(e.key)){var n=s.searchParams.map(function(e){return e.key}).indexOf(e.key);s.removeSearchParam(n)}}))},!0),s.isDefault=function(){return angular.equals(s.defaultparams,s.model)},s.idxOfList=function(e,a){var n=e.indexOf(a);if(0<=n)return n;for(var r in n=0,e){if(angular.equals(a,e[r]))return n;n+=1}return-1},s.searchParamValueChanged=function(e){c("change",e.key,e.value)},s.searchQueryChanged=function(e){},s.enterEditMode=function(e,a){if(void 0!==e){var n=s.searchParams[e];n.editMode=!0,n.inpFocus=a,s.focus=!0}},s.focusEditMode=function(e,a,n){if(void 0!==n){var r=s.searchParams[a];return!(!r.editMode||r.indexEdit!=n)}},s.leaveEditMode=function(e){if(void 0!==e){var a=s.searchParams[e];a.editMode=!1,a.value||s.removeSearchParam(e)}},s.typeaheadOnSelect=function(e,a,n){s.addSearchParam(e),s.searchQuery=""},s.isUnsedParameter=function(a){return 0===t("filter")(s.searchParams,function(e){return e.key===a.key}).length},s.addNewSearchParam=function(e){if(void 0!==s.model[e]){var a=s.model[e];void 0===a&&(a=[]),a.length<=1&&(a.push({value:"",cond:"igual"}),c("add",searchParam.key,a))}},s.addSearchParam=function(e,a,n){if(void 0===n&&(n=!0),s.isUnsedParameter(e)){for(var r=["list","number","date"],t="entre",i=0;i<r.length;i++)if(e.type==r[i]){t="igual";break}s.searchParams.push({key:e.key,name:e.name,placeholder:e.placeholder,type:e.type,options:e.options,required:e.required,value:a||[{value:"",cond:t}],editMode:n,inpFocus:0}),void 0===a&&l(function(){s.focus=!0}),c("add",e.key,a)}},s.removeSearchParam=function(e){if(void 0!==e){var a=s.searchParams[e];a.required||(s.searchParams.splice(e,1),c("delete",a.key,e))}},s.clearSearch=function(){s.searchParams=[]},s.removeAll=function(){s.searchParams=[],s.searchParams.length=0,s.searchQuery="",s.defaultparams={},s.filter={},s.model={},s.model=angular.copy(s.defaultparams),s.focus=!1},s.removeFilter=function(){s.searchParams=[],s.filter={}},s.editPrevious=function(e){void 0===e&&0<s.searchParams.length?s.enterEditMode(s.searchParams.length-1):0<e?s.enterEditMode(e-1):0<s.searchParams.length&&(s.setSearchFocus=!0)},s.editNext=function(e){void 0!==e&&(s.leaveEditMode(e),e<s.searchParams.length-1?s.enterEditMode(e+1):s.setSearchFocus=!0)},s.keydown=function(e,a){if(-1!==[9,13].indexOf(e.which)){try{!1,function(e){if(!e)return 0;{if("number"==typeof e.selectionStart)return"backward"===e.selectionDirection?e.selectionStart:e.selectionEnd;if(document.selection){e.focus();var a=document.selection.createRange(),n=document.selection.createRange().text.length;return a.moveStart("character",-e.value.length),a.text.length-n}}return 0}(e.target)}catch(e){!0}9==e.which?e.shiftKey?(e.preventDefault(),s.editPrevious(a)):(e.preventDefault(),s.editNext(a)):13==e.which&&s.editNext(a)}},void 0===s.model?s.model={}:angular.forEach(s.model,function(e,a){if("query"===a);else{var n=t("filter")(s.parameters,function(e){return e.key===a})[0];void 0!==n&&s.addSearchParam(n,e,!1)}})}]}}).directive("nitSetFocus",["$timeout","$parse",function(t,i){return{restrict:"A",link:function(n,a,r){var e=i(r.nitSetFocus);n.$watch(e,function(e){!0===e&&t(function(){a[0].focus()})}),a.bind("blur",function(){try{if("searchbox"!=r.name){var e=n.searchParams.length-1,a=n.searchParams[n.searchParams.length-1];angular.forEach(n.searchParams,function(e){e.editMode=!1}),a.value||n.removeSearchParam(e)}}catch(e){}})}}}]).directive("nitAutoSizeInput",[function(){return{restrict:"A",scope:{model:"=ngModel"},link:function(e,a,n){var r=angular.element('<div style="position: fixed; top: -9999px; left: 0px;"></div>'),t=angular.element('<span style="white-space:pre;"></span>'),i="none"===a.css("maxWidth")?a.parent().innerWidth():a.css("maxWidth");function s(){t.text(a.val()||a.attr("placeholder")),a.css("width",t.outerWidth()+25),a.css("paddingLeft",5)}a.css("maxWidth",i),angular.forEach(["fontSize","fontFamily","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","boxSizing","borderLeftWidth","borderRightWidth","borderLeftStyle","borderRightStyle","paddingLeft","paddingRight","marginLeft","marginRight"],function(e){t.css(e,a.css(e))}),angular.element("body").append(r.append(t)),s(),e.model?e.$watch("model",function(){s()}):a.on("keypress keyup keydown focus input propertychange change",function(){s()})}}}]).filter("dateUTC",function(r){return function(e,a){angular.isDefined(a)||(a="dd/MM/yyyy");var n=new Date(e);return r("date")(n.toISOString().slice(0,23),a)}})}(),angular.module("angular-filter-searchbox").run(["$templateCache",function(e){"use strict";e.put("angular-filter-searchbox.html",'<div class="advancedSearchBox" ng-class="{active:focus}" ng-init="focus=false">\n    <div class="filters styled-select green semi-square" ng-show="filters && filters.length>0">\n        <select ng-model="filter" ng-options="opt.name for opt in filters"\n            ng-change=\'clearSearch(); SelectedFilter(filter)\'>\n            <option value="">--Filtros--</option>\n        </select>\n    </div>\n    <a ng-href="" ng-click="SelectedFilter(null); removeFilter();" role="button"> <span\n            class="remove-all-icon fa fa-eraser" title="Limpar filtros selecionados" style="font-size: x-large; padding: 6px 0 0 10px"></span> </a>\n    <a ng-href="" ng-click="Save()" role="button" ng-show="searchParams.length>0"> <span\n            class="remove-all-icon fa fa-save" title="Salvar filtros selecionados" style="font-size: x-large; padding: 6px 0 0 10px"></span> </a>\n    <div ng-dblclick="!focus ? setSearchFocus=true: null">\n        <form ng-submit="Enter()">\n            <div>\n                <div class="search-parameter" ng-repeat="(iKey, searchParam) in searchParams">\n                    <a ng-href="" ng-click="addNewSearchParam(searchParam.key)" role=\\"button\\"\n                        ng-hide="searchParam.value.length>1"> <span class="remove fa fa-plus" style="font-size: 15px;"></span> </a>\n                    <a ng-href="" ng-click="removeSearchParam($index)" role=\\"button\\"\n                        ng-hide="searchParam.required"> <span class="remove fa fa-trash" style="font-size: 15px;"></span> </a>\n                    <a ng-href="" ng-click="" role=\\"button\\" ng-show="searchParam.required"> <span\n                            class="remove" style="font-size: 15px;"></span> </a>\n                    <div class="key">{{searchParam.name}}:</div>\n                    <div ng-repeat="itemValue in searchParam.value"> <span style="color:darkgreen;"\n                            ng-show="searchParam.value.length>1 && $index==0"> <b>&nbsp;OU&nbsp;</b> </span>\n                        <div class="value">\n                            <select ng-model="itemValue.cond" ng-change="searchParamValueChanged(searchParam)">\n                                <option ng-if="(option.restrict|filter:searchParam.type).length==0"\n                                    ng-repeat="option in conditions" value="{{option.value}}">{{option.key}}</option>\n                            </select>\n                        </div>\n                        <div class="value" ng-if="searchParam.type !=\'list\'"> <span ng-if="!searchParam.editMode"\n                                ng-click="enterEditMode(iKey,$index)">&nbsp;&nbsp;&nbsp;&nbsp;{{(searchParam.type==\'date\') ? (itemValue.value| date: "dd/MM/yyyy": \'America/New_York\'): itemValue.value}}</span>\n                            <input id="{{$index}}" name="{{$index}}" type="{{searchParam.type}}"\n                                ng-model-options="{timezone: \'-0300\'}" ng-keydown="keydown($event, iKey)"\n                                ng-blur="leaveEditMode(iKey)" nit-set-focus="searchParam.inpFocus=={{$index}}"\n                                ng-if="searchParam.editMode" ng-change="searchParamValueChanged(searchParam)"\n                                ng-model="itemValue.value" placeholder="{{searchParam.placeholder}}"\n                                style="width:150px" /> </div>\n                        <div class="value" ng-if="searchParam.type==\'list\'"> <span ng-if="!searchParam.editMode"\n                                ng-click="enterEditMode(iKey,$index)">&nbsp;&nbsp;&nbsp;&nbsp;{{itemValue.value.cname || itemValue.value.name}}</span>\n                            <select id="{{$index}}" name="{{$index}}" ng-keydown="keydown($event, iKey)"\n                                ng-blur="leaveEditMode(iKey);focus=false; " ng-if="searchParam.editMode"\n                                nit-set-focus="searchParam.inpFocus=={{$index}}"\n                                ng-change="searchParamValueChanged(searchParam)" ng-model="itemValue.value"\n                                ng-options="m.cname || m.name for m in searchParam.options"\n                                ng-init="itemValue.value=searchParam.options[idxOfList(searchParam.options, itemValue.value)]" />\n                            </select>\n                        </div>\n                    </div>\n                </div>\n                <input name="searchbox" class="search-parameter-input" type="text" nit-auto-size-input\n                    ng-keydown="keydown($event)" placeholder="{{placeholder}}" ng-focus="focus=true"\n                    ng-blur="focus=false" typeahead-on-select="typeaheadOnSelect($item, $model, $label)"\n                    typeahead="parameter as parameter.name for parameter in parameters | filter:isUnsedParameter | filter:{name:$viewValue}"\n                    nit-set-focus="setSearchFocus" />\n            </div>\n            <div class="search-parameter-suggestions" ng-show="(parameters | filter:isUnsedParameter).length && focus">\n                <span class="title">Filtros:</span> <span class="search-parameter"\n                    ng-repeat="param in parameters | filter:isUnsedParameter"\n                    ng-mousedown="addSearchParam(param)">{{param.name}}</span> </div>\n        </form>\n    </div>\n</div>')}]);