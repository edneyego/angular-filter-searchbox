/*! 
 * angular-filter-searchbox v1.0.0
 * https://github.com/edneyego/angular-filter-searchbox
 * Copyright (c) 2019 Nauck IT KG http://www.nauck-it.de/
 * License: MIT
 */

!function(){"use strict";angular.module("angular-filter-searchbox",[]).directive("nitFilterSearchbox",function(){return{restrict:"E",scope:{model:"=ngModel",parameters:"=",defaultparams:"=",filters:"=",enter:"=",save:"=",selectedFilter:"=",placeholder:"@"},replace:!0,templateUrl:function(e,a){return a.templateUrl||"angular-filter-searchbox.html"},controller:["$scope","$attrs","$element","$timeout","$filter",function(s,e,a,c,n){var t;s.placeholder=s.placeholder||"Search ...",s.searchParams=[],s.conditions=[{key:"=",value:"igual",restrict:[]},{key:"> <",value:"entre",restrict:["date","number","floating","list"]},{key:">",value:"maior_que",restrict:["text","list"]},{key:">=",value:"maior_igual",restrict:["text","list"]},{key:"<",value:"menor_que",restrict:["text","list"]},{key:"<=",value:"menor_igual",restrict:["text","list"]},{key:"< >",value:"diferente",restrict:[]}],s.selectedConditional="igual",s.searchQuery="",s.setSearchFocus=!1,s.Enter=s.enter,s.Save=s.save,s.SelectedFilter=s.selectedFilter;var i=[];function l(e,a,r){t&&c.cancel(t),(i=n("filter")(i,function(e){return e.key!==a})).push({command:e,key:a,value:r}),t=c(function(){angular.forEach(i,function(e){"delete"===e.command?delete s.model[e.key]:s.model[e.key]=e.value}),i.length=0},500)}s.defaultparams?s.defaultparams.query:s.defaultparams={},s.model=angular.copy(s.defaultparams),s.$watch("defaultparams",function(){s.model=angular.copy(s.defaultparams)}),s.$watch("model",function(e,a){angular.equals(e,a)||(angular.forEach(s.model,function(e,a){if("query"===a&&s.searchQuery!==e);else{var r=n("filter")(s.parameters,function(e){return e.key===a})[0],t=n("filter")(s.searchParams,function(e){return e.key===a})[0];void 0!==r&&(void 0===t?s.addSearchParam(r,e,!1):t.value!==e&&(t.value=e))}}),angular.forEach(s.searchParams,function(e,a){if(!s.model.hasOwnProperty(e.key)){var r=s.searchParams.map(function(e){return e.key}).indexOf(e.key);s.removeSearchParam(r)}}))},!0),s.isDefault=function(){return angular.equals(s.defaultparams,s.model)},s.idxOfList=function(e,a){var r=e.indexOf(a);if(0<=r)return r;for(var t in r=0,e){if(angular.equals(a,e[t]))return r;r+=1}return-1},s.searchParamValueChanged=function(e){l("change",e.key,e.value)},s.searchQueryChanged=function(e){},s.enterEditMode=function(e,a){if(void 0!==e){var r=s.searchParams[e];r.editMode=!0,r.inpFocus=a,s.focus=!0}},s.focusEditMode=function(e,a,r){if(void 0!==r){var t=s.searchParams[a];return!(!t.editMode||t.indexEdit!=r)}},s.leaveEditMode=function(e){if(void 0!==e){var a=s.searchParams[e];a.editMode=!1,a.value||s.removeSearchParam(e)}},s.typeaheadOnSelect=function(e,a,r){s.addSearchParam(e),s.searchQuery=""},s.isUnsedParameter=function(a){return 0===n("filter")(s.searchParams,function(e){return e.key===a.key}).length},s.addNewSearchParam=function(e){if(void 0!==s.model[e]){var a=s.model[e];void 0===a&&(a=[]),a.length<=1&&(a.push({value:"",cond:"igual"}),l("add",searchParam.key,a))}},s.addSearchParam=function(e,a,r){if(void 0===r&&(r=!0),s.isUnsedParameter(e)){for(var t=["list","number","date"],n="entre",i=0;i<t.length;i++)if(e.type==t[i]){n="igual";break}s.searchParams.push({key:e.key,name:e.name,placeholder:e.placeholder,type:e.type,options:e.options,required:e.required,value:a||[{value:"",cond:n}],editMode:r,inpFocus:0}),void 0===a&&c(function(){s.focus=!0}),l("add",e.key,a)}},s.removeSearchParam=function(e){if(void 0!==e){var a=s.searchParams[e];a.required||(s.searchParams.splice(e,1),l("delete",a.key,e))}},s.clearSearch=function(){s.searchParams=[]},s.removeAll=function(){s.searchParams=[],s.searchParams.length=0,s.searchQuery="",s.defaultparams={},s.filter={},s.model={},s.model=angular.copy(s.defaultparams),s.focus=!1},s.removeFilter=function(){s.searchParams=[],s.filter={}},s.editPrevious=function(e){void 0===e&&0<s.searchParams.length?s.enterEditMode(s.searchParams.length-1):0<e?s.enterEditMode(e-1):0<s.searchParams.length&&(s.setSearchFocus=!0)},s.editNext=function(e){void 0!==e&&(s.leaveEditMode(e),e<s.searchParams.length-1?s.enterEditMode(e+1):s.setSearchFocus=!0)},s.keydown=function(e,a){if(-1!==[9,13].indexOf(e.which)){try{!1,function(e){if(!e)return 0;{if("number"==typeof e.selectionStart)return"backward"===e.selectionDirection?e.selectionStart:e.selectionEnd;if(document.selection){e.focus();var a=document.selection.createRange(),r=document.selection.createRange().text.length;return a.moveStart("character",-e.value.length),a.text.length-r}}return 0}(e.target)}catch(e){!0}9==e.which?e.shiftKey?(e.preventDefault(),s.editPrevious(a)):(e.preventDefault(),s.editNext(a)):13==e.which&&s.editNext(a)}},void 0===s.model?s.model={}:angular.forEach(s.model,function(e,a){if("query"===a);else{var r=n("filter")(s.parameters,function(e){return e.key===a})[0];void 0!==r&&s.addSearchParam(r,e,!1)}})}]}}).directive("nitSetFocus",["$timeout","$parse",function(n,i){return{restrict:"A",link:function(r,a,t){var e=i(t.nitSetFocus);r.$watch(e,function(e){!0===e&&n(function(){a[0].focus()})}),a.bind("blur",function(){try{if("searchbox"!=t.name){var e=r.searchParams.length-1,a=r.searchParams[r.searchParams.length-1];angular.forEach(r.searchParams,function(e){e.editMode=!1}),a.value||r.removeSearchParam(e)}}catch(e){}})}}}]).directive("nitAutoSizeInput",[function(){return{restrict:"A",scope:{model:"=ngModel"},link:function(e,a,r){var t=angular.element('<div style="position: fixed; top: -9999px; left: 0px;"></div>'),n=angular.element('<span style="white-space:pre;"></span>'),i="none"===a.css("maxWidth")?a.parent().innerWidth():a.css("maxWidth");function s(){n.text(a.val()||a.attr("placeholder")),a.css("width",n.outerWidth()+25),a.css("paddingLeft",5)}a.css("maxWidth",i),angular.forEach(["fontSize","fontFamily","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","boxSizing","borderLeftWidth","borderRightWidth","borderLeftStyle","borderRightStyle","paddingLeft","paddingRight","marginLeft","marginRight"],function(e){n.css(e,a.css(e))}),angular.element("body").append(t.append(n)),s(),e.model?e.$watch("model",function(){s()}):a.on("keypress keyup keydown focus input propertychange change",function(){s()})}}}]).filter("dateUTC",function(t){return function(e,a){angular.isDefined(a)||(a="dd/MM/yyyy");var r=new Date(e);return t("date")(r.toISOString().slice(0,23),a)}})}(),angular.module("angular-filter-searchbox").run(["$templateCache",function(e){"use strict";e.put("angular-filter-searchbox.html",'<div class=filterSearchBox ng-class={active:focus} ng-init="focus=false" ng-click="!focus ? focus=true : null" ng-mouseleave="!focus ? focus=true : null"><div class="filters styled-select green semi-square" ng-show="filters && filters.length>0"><select ng-model=filter ng-options="opt.name for opt in filters" ng-change="clearSearch(); SelectedFilter(filter)"><option value="">--Filtros--</option></select></div><a ng-href="" ng-click=Enter() role=button><span class="remove-all-icon fa fa-search"></span> </a><a ng-href="" ng-click="SelectedFilter(null); removeFilter();" role=button><span class="remove-all-icon fa fa-eraser"></span> </a><a ng-href="" ng-click=Save() role=button ng-show="searchParams.length>0"><span class="remove-all-icon fa fa-save"></span></a><div ng-dblclick="!focus ? setSearchFocus=true: null"><form ng-submit=Enter()><div><div class=search-parameter ng-repeat="(iKey, searchParam) in searchParams"><a ng-href="" ng-click=addNewSearchParam(searchParam.key) role=button ng-hide="searchParam.value.length>1"><span class="remove fa fa-plus"></span> </a><a ng-href="" ng-click=removeSearchParam($index) role=button ng-hide=searchParam.required><span class="remove fa fa-trash"></span> </a><a ng-href="" ng-click="" role=button ng-show=searchParam.required><span class=remove></span></a><div class=key>{{searchParam.name}}:</div><div ng-repeat="itemValue in searchParam.value"><span style=color:darkgreen ng-show="searchParam.value.length>1 && $index==0"><b>&nbsp;OU&nbsp;</b></span><div class=value><select ng-model=itemValue.cond ng-change=searchParamValueChanged(searchParam)><option ng-if="(option.restrict|filter:searchParam.type).length==0" ng-repeat="option in conditions" value={{option.value}}>{{option.key}}</option></select></div><div class=value ng-if="searchParam.type !=\'list\'"><span ng-if=!searchParam.editMode ng-click=enterEditMode(iKey,$index)>&nbsp;&nbsp;&nbsp;&nbsp;{{(searchParam.type == \'date\') ? (itemValue.value| date: "dd/MM/yyyy": \'America/New_York\'): itemValue.value}}</span> <input id={{$index}} name={{$index}} type={{searchParam.type}} ng-model-options="{ timezone: \'-0300\' }" ng-keydown="keydown($event, iKey)" ng-blur=leaveEditMode(iKey) nit-set-focus="searchParam.inpFocus=={{$index}}" ng-if=searchParam.editMode ng-change=searchParamValueChanged(searchParam) ng-model=itemValue.value placeholder={{searchParam.placeholder}} style=width:150px></div><div class=value ng-if="searchParam.type==\'list\'"><span ng-if=!searchParam.editMode ng-click=enterEditMode(iKey,$index)>&nbsp;&nbsp;&nbsp;&nbsp;{{itemValue.value.cname || itemValue.value.name}}</span><select id={{$index}} name={{$index}} ng-keydown="keydown($event, iKey)" ng-blur="leaveEditMode(iKey);focus=false; " ng-if=searchParam.editMode nit-set-focus="searchParam.inpFocus=={{$index}}" ng-change=searchParamValueChanged(searchParam) ng-model=itemValue.value ng-options="m.cname || m.name for m in searchParam.options" ng-init="itemValue.value=searchParam.options[idxOfList(searchParam.options, itemValue.value)]"></div></div></div><input name=searchbox class=search-parameter-input nit-auto-size-input ng-keydown=keydown($event) placeholder={{placeholder}} ng-focus="focus=true" ng-blur="focus=false" typeahead-on-select="typeaheadOnSelect($item, $model, $label)" typeahead="parameter as parameter.name for parameter in parameters | filter:isUnsedParameter | filter:{name:$viewValue}" nit-set-focus=setSearchFocus></div><div class=search-parameter-suggestions ng-show="(parameters | filter:isUnsedParameter).length && focus"><span class=title>Filtros:</span> <span class=search-parameter ng-repeat="param in parameters | filter:isUnsedParameter" ng-mousedown=addSearchParam(param)>{{param.name}}</span></div></form></div></div>')}]);