/*! 
 * angular-filter-searchbox v1.0.0
 * https://github.com/edneyego/angular-filter-searchbox
 * Copyright (c) 2019 Nauck IT KG http://www.nauck-it.de/
 * License: MIT
 */

!function(){"use strict";angular.module("angular-filter-searchbox",[]).directive("nitAdvancedSearchbox",function(){return{restrict:"E",scope:{model:"=ngModel",parameters:"=",defaultparams:"=",filters:"=",enter:"=",save:"=",selectedFilter:"=",placeholder:"@"},replace:!0,templateUrl:function(e,a){return a.templateUrl||"angular-filter-searchbox.html"},controller:["$scope","$attrs","$element","$timeout","$filter",function(c,e,a,o,n){var r;c.placeholder=c.placeholder||"Search ...",c.searchParams=[],c.conditions=[{key:"=",value:"igual",restrict:[]},{key:"> <",value:"entre",restrict:["date","number","floating","list"]},{key:">",value:"maior_que",restrict:["text","list"]},{key:">=",value:"maior_igual",restrict:["text","list"]},{key:"<",value:"menor_que",restrict:["text","list"]},{key:"<=",value:"menor_igual",restrict:["text","list"]},{key:"< >",value:"diferente",restrict:[]}],c.selectedConditional="igual",c.searchQuery="",c.setSearchFocus=!1,c.Enter=c.enter,c.Save=c.save,c.SelectedFilter=c.selectedFilter;var i=[];function u(e,a,t){r&&o.cancel(r),(i=n("filter")(i,function(e){return e.key!==a})).push({command:e,key:a,value:t}),r=o(function(){angular.forEach(i,function(e){"delete"===e.command?delete c.model[e.key]:c.model[e.key]=e.value}),i.length=0},500)}c.defaultparams?c.defaultparams.query:c.defaultparams={},c.model=angular.copy(c.defaultparams),c.$watch("defaultparams",function(){c.model=angular.copy(c.defaultparams)}),c.$watch("model",function(e,a){angular.equals(e,a)||(angular.forEach(c.model,function(e,a){if("query"===a&&c.searchQuery!==e);else{var t=n("filter")(c.parameters,function(e){return e.key===a})[0],r=n("filter")(c.searchParams,function(e){return e.key===a})[0];void 0!==t&&(void 0===r?c.addSearchParam(t,e,!1):r.value!==e&&(r.value=e))}}),angular.forEach(c.searchParams,function(e,a){if(!c.model.hasOwnProperty(e.key)){var t=c.searchParams.map(function(e){return e.key}).indexOf(e.key);c.removeSearchParam(t)}}))},!0),c.isDefault=function(){return angular.equals(c.defaultparams,c.model)},c.idxOfList=function(e,a){var t=e.indexOf(a);if(0<=t)return t;for(var r in t=0,e){if(angular.equals(a,e[r]))return t;t+=1}return-1},c.searchParamValueChanged=function(e){u("change",e.key,e.value)},c.searchQueryChanged=function(e){},c.enterEditMode=function(e,a){if(void 0!==e){var t=c.searchParams[e];t.editMode=!0,t.inpFocus=a,c.focus=!0}},c.focusEditMode=function(e,a,t){if(void 0!==t){var r=c.searchParams[a];return!(!r.editMode||r.indexEdit!=t)}},c.leaveEditMode=function(e){if(void 0!==e){var a=c.searchParams[e];a.editMode=!1,a.value||c.removeSearchParam(e)}},c.typeaheadOnSelect=function(e,a,t){c.addSearchParam(e),c.searchQuery=""},c.isUnsedParameter=function(a){return 0===n("filter")(c.searchParams,function(e){return e.key===a.key}).length},c.addNewSearchParam=function(e){if(void 0!==c.model[e]){var a=c.model[e];void 0===a&&(a=[]),a.length<=1&&(a.push({value:"",cond:"igual"}),u("add",searchParam.key,a))}},c.addSearchParam=function(e,a,t){if(void 0===t&&(t=!0),c.isUnsedParameter(e)){for(var r=["list","number","date"],n="entre",i=0;i<r.length;i++)if(e.type==r[i]){n="igual";break}c.searchParams.push({key:e.key,name:e.name,placeholder:e.placeholder,type:e.type,options:e.options,required:e.required,value:a||[{value:"",cond:n}],editMode:t,inpFocus:0}),void 0===a&&o(function(){c.focus=!0}),u("add",e.key,a)}},c.removeSearchParam=function(e){if(void 0!==e){var a=c.searchParams[e];a.required||(c.searchParams.splice(e,1),u("delete",a.key,e))}},c.clearSearch=function(){c.searchParams=[]},c.removeAll=function(){c.searchParams=[],c.searchParams.length=0,c.searchQuery="",c.defaultparams={},c.filter={},c.model={},c.model=angular.copy(c.defaultparams),c.focus=!1},c.removeFilter=function(){c.searchParams=[],c.filter={}},c.editPrevious=function(e){void 0===e&&0<c.searchParams.length?c.enterEditMode(c.searchParams.length-1):0<e?c.enterEditMode(e-1):0<c.searchParams.length&&(c.setSearchFocus=!0)},c.editNext=function(e){void 0!==e&&(c.leaveEditMode(e),e<c.searchParams.length-1?c.enterEditMode(e+1):c.setSearchFocus=!0)},c.keydown=function(e,a){if(-1!==[9,13].indexOf(e.which)){try{!1,function(e){if(!e)return 0;{if("number"==typeof e.selectionStart)return"backward"===e.selectionDirection?e.selectionStart:e.selectionEnd;if(document.selection){e.focus();var a=document.selection.createRange(),t=document.selection.createRange().text.length;return a.moveStart("character",-e.value.length),a.text.length-t}}return 0}(e.target)}catch(e){!0}9==e.which?e.shiftKey?(e.preventDefault(),c.editPrevious(a)):(e.preventDefault(),c.editNext(a)):13==e.which&&c.editNext(a)}},void 0===c.model?c.model={}:angular.forEach(c.model,function(e,a){if("query"===a);else{var t=n("filter")(c.parameters,function(e){return e.key===a})[0];void 0!==t&&c.addSearchParam(t,e,!1)}})}]}}).directive("nitSetFocus",["$timeout","$parse",function(n,i){return{restrict:"A",link:function(t,a,r){var e=i(r.nitSetFocus);t.$watch(e,function(e){!0===e&&n(function(){a[0].focus()})}),a.bind("blur",function(){try{if("searchbox"!=r.name){var e=t.searchParams.length-1,a=t.searchParams[t.searchParams.length-1];angular.forEach(t.searchParams,function(e){e.editMode=!1}),a.value||t.removeSearchParam(e)}}catch(e){}})}}}]).directive("nitAutoSizeInput",[function(){return{restrict:"A",scope:{model:"=ngModel"},link:function(e,a,t){var r=angular.element('<div style="position: fixed; top: -9999px; left: 0px;"></div>'),n=angular.element('<span style="white-space:pre;"></span>'),i="none"===a.css("maxWidth")?a.parent().innerWidth():a.css("maxWidth");function c(){n.text(a.val()||a.attr("placeholder")),a.css("width",n.outerWidth()+25),a.css("paddingLeft",5)}a.css("maxWidth",i),angular.forEach(["fontSize","fontFamily","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","boxSizing","borderLeftWidth","borderRightWidth","borderLeftStyle","borderRightStyle","paddingLeft","paddingRight","marginLeft","marginRight"],function(e){n.css(e,a.css(e))}),angular.element("body").append(r.append(n)),c(),e.model?e.$watch("model",function(){c()}):a.on("keypress keyup keydown focus input propertychange change",function(){c()})}}}]).filter("dateUTC",function(r){return function(e,a){angular.isDefined(a)||(a="dd/MM/yyyy");var t=new Date(e);return r("date")(t.toISOString().slice(0,23),a)}})}();