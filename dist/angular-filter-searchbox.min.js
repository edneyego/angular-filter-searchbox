/*! 
 * angular-filter-searchbox v1.0.0
 * https://github.com/edneyego/angular-filter-searchbox
 * Copyright (c) 2019 Nauck IT KG http://www.nauck-it.de/
 * License: MIT
 */

!function(){"use strict";angular.module("angular-filter-searchbox",[]).directive("nitFilterSearchbox",function(){return{restrict:"E",scope:{model:"=ngModel",parameters:"=",defaultparams:"=",filters:"=",enter:"=",save:"=",selectedFilter:"=",placeholder:"@"},replace:!0,templateUrl:function(e,a){return a.templateUrl||"angular-filter-searchbox.html"},controller:["$scope","$attrs","$element","$timeout","$filter",function(o,e,a,c,n){var r;o.placeholder=o.placeholder||"Search ...",o.searchParams=[],o.conditions=[{key:"=",value:"igual",restrict:[]},{key:"> <",value:"entre",restrict:["date","number","floating","list"]},{key:">",value:"maior_que",restrict:["text","list"]},{key:">=",value:"maior_igual",restrict:["text","list"]},{key:"<",value:"menor_que",restrict:["text","list"]},{key:"<=",value:"menor_igual",restrict:["text","list"]},{key:"< >",value:"diferente",restrict:[]}],o.selectedConditional="igual",o.searchQuery="",o.setSearchFocus=!1,o.Enter=o.enter,o.Save=o.save,o.SelectedFilter=o.selectedFilter;var i=[];function l(e,a,t){r&&c.cancel(r),(i=n("filter")(i,function(e){return e.key!==a})).push({command:e,key:a,value:t}),r=c(function(){angular.forEach(i,function(e){"delete"===e.command?delete o.model[e.key]:o.model[e.key]=e.value}),i.length=0},500)}o.defaultparams?o.defaultparams.query:o.defaultparams={},o.model=angular.copy(o.defaultparams),o.$watch("defaultparams",function(){o.model=angular.copy(o.defaultparams)}),o.$watch("model",function(e,a){angular.equals(e,a)||(angular.forEach(o.model,function(e,a){if("query"===a&&o.searchQuery!==e);else{var t=n("filter")(o.parameters,function(e){return e.key===a})[0],r=n("filter")(o.searchParams,function(e){return e.key===a})[0];void 0!==t&&(void 0===r?o.addSearchParam(t,e,!1):r.value!==e&&(r.value=e))}}),angular.forEach(o.searchParams,function(e,a){if(!o.model.hasOwnProperty(e.key)){var t=o.searchParams.map(function(e){return e.key}).indexOf(e.key);o.removeSearchParam(t)}}))},!0),o.isDefault=function(){return angular.equals(o.defaultparams,o.model)},o.idxOfList=function(e,a){var t=e.indexOf(a);if(0<=t)return t;for(var r in t=0,e){if(angular.equals(a,e[r]))return t;t+=1}return-1},o.searchParamValueChanged=function(e){l("change",e.key,e.value)},o.searchQueryChanged=function(e){},o.enterEditMode=function(e,a){if(void 0!==e){var t=o.searchParams[e];t.editMode=!0,t.inpFocus=a,o.focus=!0}},o.focusEditMode=function(e,a,t){if(void 0!==t){var r=o.searchParams[a];return!(!r.editMode||r.indexEdit!=t)}},o.leaveEditMode=function(e){if(void 0!==e){var a=o.searchParams[e];a.editMode=!1,a.value||o.removeSearchParam(e)}},o.typeaheadOnSelect=function(e,a,t){o.addSearchParam(e),o.searchQuery=""},o.isUnsedParameter=function(a){return 0===n("filter")(o.searchParams,function(e){return e.key===a.key}).length},o.addNewSearchParam=function(e){if(void 0!==o.model[e]){var a=o.model[e];void 0===a&&(a=[]),a.length<=1&&(a.push({value:"",cond:"igual"}),l("add",searchParam.key,a))}},o.addSearchParam=function(e,a,t){if(void 0===t&&(t=!0),o.isUnsedParameter(e)){for(var r=["list","number","date"],n="entre",i=0;i<r.length;i++)if(e.type==r[i]){n="igual";break}o.searchParams.push({key:e.key,name:e.name,placeholder:e.placeholder,type:e.type,options:e.options,required:e.required,value:a||[{value:"",cond:n}],editMode:t,inpFocus:0}),void 0===a&&c(function(){o.focus=!0}),l("add",e.key,a)}},o.removeSearchParam=function(e){if(void 0!==e){var a=o.searchParams[e];a.required||(o.searchParams.splice(e,1),l("delete",a.key,e))}},o.clearSearch=function(){o.searchParams=[]},o.removeAll=function(){o.searchParams=[],o.searchParams.length=0,o.searchQuery="",o.defaultparams={},o.filter={},o.model={},o.model=angular.copy(o.defaultparams),o.focus=!1},o.removeFilter=function(){o.searchParams=[],o.filter={}},o.editPrevious=function(e){void 0===e&&0<o.searchParams.length?o.enterEditMode(o.searchParams.length-1):0<e?o.enterEditMode(e-1):0<o.searchParams.length&&(o.setSearchFocus=!0)},o.editNext=function(e){void 0!==e&&(o.leaveEditMode(e),e<o.searchParams.length-1?o.enterEditMode(e+1):o.setSearchFocus=!0)},o.keydown=function(e,a){if(-1!==[9,13].indexOf(e.which)){try{!1,function(e){if(!e)return 0;{if("number"==typeof e.selectionStart)return"backward"===e.selectionDirection?e.selectionStart:e.selectionEnd;if(document.selection){e.focus();var a=document.selection.createRange(),t=document.selection.createRange().text.length;return a.moveStart("character",-e.value.length),a.text.length-t}}return 0}(e.target)}catch(e){!0}9==e.which?e.shiftKey?(e.preventDefault(),o.editPrevious(a)):(e.preventDefault(),o.editNext(a)):13==e.which&&o.editNext(a)}},void 0===o.model?o.model={}:angular.forEach(o.model,function(e,a){if("query"===a);else{var t=n("filter")(o.parameters,function(e){return e.key===a})[0];void 0!==t&&o.addSearchParam(t,e,!1)}})}]}}).directive("nitSetFocus",["$timeout","$parse",function(n,i){return{restrict:"A",link:function(t,a,r){var e=i(r.nitSetFocus);t.$watch(e,function(e){!0===e&&n(function(){a[0].focus()})}),a.bind("blur",function(){try{if("searchbox"!=r.name){var e=t.searchParams.length-1,a=t.searchParams[t.searchParams.length-1];angular.forEach(t.searchParams,function(e){e.editMode=!1}),a.value||t.removeSearchParam(e)}}catch(e){}})}}}]).directive("nitAutoSizeInput",[function(){return{restrict:"A",scope:{model:"=ngModel"},link:function(e,a,t){var r=angular.element('<div style="position: fixed; top: -9999px; left: 0px;"></div>'),n=angular.element('<span style="white-space:pre;"></span>'),i="none"===a.css("maxWidth")?a.parent().innerWidth():a.css("maxWidth");function o(){n.text(a.val()||a.attr("placeholder")),a.css("width",n.outerWidth()+25),a.css("paddingLeft",5)}a.css("maxWidth",i),angular.forEach(["fontSize","fontFamily","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent","boxSizing","borderLeftWidth","borderRightWidth","borderLeftStyle","borderRightStyle","paddingLeft","paddingRight","marginLeft","marginRight"],function(e){n.css(e,a.css(e))}),angular.element("body").append(r.append(n)),o(),e.model?e.$watch("model",function(){o()}):a.on("keypress keyup keydown focus input propertychange change",function(){o()})}}}]).filter("dateUTC",function(r){return function(e,a){angular.isDefined(a)||(a="dd/MM/yyyy");var t=new Date(e);return r("date")(t.toISOString().slice(0,23),a)}})}();